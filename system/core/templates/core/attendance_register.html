{% extends 'base.html' %}
{% block content %}

{# ===== メッセージ表示 ===== #}
{% if messages %}
<div style="text-align:center; margin-top:20px;">
    {% for message in messages %}
        <div style="
            display:inline-block;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            {% if message.tags == 'success' %}
                background-color: #d4edda; color: #155724;
            {% elif message.tags == 'error' %}
                background-color: #f8d7da; color: #721c24;
            {% elif message.tags == 'warning' %}
                background-color: #fff3cd; color: #856404;
            {% else %}
                background-color: #cce5ff; color: #004085;
            {% endif %}
        ">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}

{# ===== ヘッダー ===== #}
<header style="
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    background-color: #28a745;
    color: white;
    font-size:1.2rem;
">
    <h1 style="margin: 0; font-size: 1.8rem;">学習管理システム</h1>
    <nav>
        <ul style="list-style:none;display:flex;gap:20px;margin:0;padding:0;">
            <li><a href="{% url 'core:student_home' %}" style="color:white;font-weight:bold;text-decoration:none;">ホーム</a></li>
            <li><a href="{% url 'core:grade_view' %}" style="color:white;font-weight:bold;text-decoration:none;">成績閲覧</a></li>
            <li><a href="{% url 'core:manage_grades' %}" style="color:white;font-weight:bold;text-decoration:none;">成績管理</a></li>
            <li><a href="{% url 'core:attendance_plan' %}" style="color:white;font-weight:bold;text-decoration:none;">出席計画</a></li>
            <li><a href="{% url 'core:manual' %}" style="color:white;font-weight:bold;text-decoration:none;">使い方</a></li>
            <li>
                <form method="POST" action="{% url 'core:logout' %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" style="background:none;border:none;color:white;font-weight:bold;cursor:pointer;">
                        ログアウト
                    </button>
                </form>
            </li>
        </ul>
    </nav>
</header>

{# ===== メイン ===== #}
<div style="padding:50px;display:flex;flex-direction:column;align-items:center;font-size:1.2rem;">

    {# ===== 登録フォーム ===== #}
    <div style="
        background:white;
        padding:40px 50px;
        border-radius:12px;
        box-shadow:0 4px 12px rgba(0,0,0,0.1);
        width:90%;
        max-width:850px;
        text-align:center;
    ">
        <h2 style="font-size:1.8rem;">出席回数を登録</h2>

        <form method="POST" action="{% url 'core:attendance_register' %}" style="margin-top:30px;">
            {% csrf_token %}

            {# 科目 #}
            <label style="font-size:1.2rem;">科目：</label><br>
            <select name="subject_id"
                required
                style="
                    width:60%;
                    margin:15px auto;
                    font-size:1.2rem;
                    padding:10px;
                    display:block;
                ">
                <option value="">── 科目を選択してください ──</option>

                {% for subject in subjects %}
                    {% if subject.lesson_count %}
                        <option value="{{ subject.subject_id }}">
                            {{ subject.subject_name }}
                        </option>
                    {% else %}
                        <option disabled>
                            {{ subject.subject_name }}（授業回数未登録）
                        </option>
                    {% endif %}
                {% endfor %}
            </select>

            {# 注意文 #}
            <p style="color:red;font-size:1rem;margin-top:5px;">
                ※ 授業回数が未登録の科目は選択できません
            </p>

            {# 出席日数 #}
            <label style="font-size:1.2rem;">出席日数：</label><br>
            <select name="attend_days"
                style="
                    width:60%;
                    margin:15px auto;
                    font-size:1.2rem;
                    padding:10px;
                    display:block;
                ">
                {% for i in attendance_range %}
                    <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>

            {# 登録ボタン（見た目そのまま） #}
            <div style="text-align:center; margin-top:30px;">
                <button type="submit" class="btn btn-primary"
                    style="
                        padding:12px 35px;
                        font-size:1.2rem;
                        background-color: #28a745;
                        color:white;
                        text-decoration: none;
                        border-radius:5px;
                        font-weight:bold;
                        display:inline-block;
                        margin-top:30px;
                    ">
                    登録
                </button>
            </div>
        </form>
    </div>

    {# ===== 登録済み一覧 ===== #}
    <div style="
        background:white;
        margin-top:50px;
        padding:40px 50px;
        border-radius:12px;
        box-shadow:0 4px 12px rgba(0,0,0,0.1);
        width:90%;
        max-width:850px;
        text-align:center;
    ">
        <h2 style="font-size:1.8rem;">登録済み出席情報</h2>

        <table style="width:100%;border-collapse:collapse;margin-top:20px;">
            <thead style="background:#f2f2f2;">
                <tr>
                    <th style="padding:12px;border:1px solid #ddd;">科目名</th>
                    <th style="padding:12px;border:1px solid #ddd;">出席日数</th>
                </tr>
            </thead>
            <tbody>
                {% for subject in subjects %}
                    <tr>
                        <td style="padding:12px;border:1px solid #ddd;">{{ subject.subject_name }}</td>
                        <td style="padding:12px;border:1px solid #ddd;">{{ subject.attend_days }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="2" style="padding:12px;">登録されていません。</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {# 戻るボタン #}
    <div style="margin-top:40px;">
        <form method="GET" action="{% url 'core:manage_grades' %}">
            <button type="submit" class="btn btn-secondary" 
            style="
            padding: 12px 35px;
            font-size: 1.2rem;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
            margin-top: 30px;
            ">← 成績管理に戻る</button>
        </form>
    </div>

</div>
{% endblock %}
